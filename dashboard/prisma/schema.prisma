// https://vercel.com/guides/nextjs-prisma-postgres
// https://www.prisma.io/docs/orm/prisma-client/deployment/serverless/deploy-to-vercel

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider  = "postgresql"
    url       = env("POSTGRES_PRISMA_URL")
    directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Experiment {
    id Int @id @default(autoincrement())

    createdAt DateTime @default(now())
    commitId  String   @db.VarChar(256)

    tag    String @db.VarChar(256)
    course String @db.VarChar(256)
    levels String @db.VarChar(256)
    args   String @db.VarChar(256)

    runs Run[]
}

model Run {
    id           Int  @id @default(autoincrement())
    experimentId Int?

    createdAt DateTime @default(now())
    commitId  String   @db.VarChar(256)

    course String @db.VarChar(256)
    level  Int
    args   String @db.VarChar(256)

    success    SuccessfulRun?
    failed     FailedRun?
    experiment Experiment?    @relation(fields: [experimentId], references: [id])
}

model SuccessfulRun {
    id    Int @id @default(autoincrement())
    runId Int @unique

    createdAt DateTime @default(now())

    elapsedSec Int
    score      BigInt

    // /runs/{runId}/solution 固定
    // solutionKey String @db.VarChar(48)

    run Run @relation(fields: [runId], references: [id])
}

model FailedRun {
    id    Int @id @default(autoincrement())
    runId Int @unique

    createdAt DateTime @default(now())

    elapsedSec Int
    error      String @db.Text

    run Run @relation(fields: [runId], references: [id])
}
